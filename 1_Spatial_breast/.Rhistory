library(Seurat)
library(ggplot2)
library(cowplot)
library(dplyr)
data <- Read10X_h5("Visium_FFPE_Human_Breast_Cancer_filtered_feature_bc_matrix.h5")
data1 <- CreateSeuratObject(counts = data,project = "data1",assay = "Spatial")
image <- Read10X_Image(image.dir = "./spatial")
DefaultAssay(object = image) <- 'Spatial'
image <- image[colnames(x=data1)]
data1[['image']] <- image
data1 <- SCTransform(data1,assay = "Spatial", return.only.var.genes = FALSE,verbose = T)
data1 <- RunPCA(data1, assay = "SCT", verbose = FALSE)
ElbowPlot(data1, ndims = 40)
data1 <- FindNeighbors(data1, reduction = "pca", dims = 1:30)
data1 <- FindClusters(data1, verbose = FALSE,resolution = 1)
data1 <- RunUMAP(data1, reduction = "pca", dims = 1:30)
p1 <- DimPlot(data1, reduction = "umap", label = TRUE)
p2 <- SpatialDimPlot(data1, label = TRUE, label.size = 3)
plot_grid(p1, p2)
pdf(file = "dimplot_raw.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=T,label.size=3,pt.size.factor = 1)
dev.off()
DefaultAssay(data1)<-"SCT"
total.markers <- FindAllMarkers(data1, min.pct = 0.5, min.diff.pct = 0.1, logfc.threshold =0.25, only.pos = TRUE, test.use = "wilcox")
write.csv(total.markers,"total.markers.csv")
top10 <- total.markers %>% group_by(cluster) %>% top_n(n = 10, wt = avg_log2FC)
pdf(file = "Top10geneHeatmap.pdf",width = 12,height = 14)
DoHeatmap(data1, features = top10$gene,slot="data") +
scale_fill_gradientn(colors = c("grey98","gold","orange","red","red3")) +
NoLegend()
dev.off()
FeaturePlot(data1,features = c("CD8A"),label = T,ncol = 1)
FeaturePlot(data1,features = c("MARCO"),label = T,ncol = 1)
FeaturePlot(data1,features = c("PTPRC"),label = T,ncol = 1)
FeaturePlot(data1,features = c("VWF"),label = T,ncol = 1)
FeaturePlot(data1,features = c("SDC1"),label = T,ncol = 1)
FeaturePlot(data1,features = c("OXTR"),label = T,ncol = 1)
FeaturePlot(data1,features = c("CDH3"),label = T,ncol = 1)
FeaturePlot(data1,features = c("COL1A1"),label = T,ncol = 1)
FeaturePlot(data1,features = c("PTPRC"),label = T,ncol = 1)
FeaturePlot(data1,features = c("MARCO"),label = T,ncol = 1)
FeaturePlot(data1,features = c("CD163"),label = T,ncol = 1)
FeaturePlot(data1,features = c("CCL3"),label = T,ncol = 1)
FeaturePlot(data1,features = c("CCL4"),label = T,ncol = 1)
FeaturePlot(data1,features = c("HLA-DRA"),label = T,ncol = 1)
FeaturePlot(data1,features = c("FABP4"),label = T,ncol = 1)
FeaturePlot(data1,features = c("GPX3"),label = T,ncol = 1)
FeaturePlot(data1,features = c("ADH1B"),label = T,ncol = 1)
cluster_name <- plyr::mapvalues(x = data1@active.ident, from = 0:13, to = c("clu0__T cell","clu1__Fibroblast","clu2__Plasma cell","clu3__Macrophage","clu4__Cancer cell","clu5__Cancer cell",
"clu6__Cancer cell","clu7__Cancer cell","clu8__Fibroblast","clu9__Macrophage","clu10__Endothelial","Clu11__Fibroblast","Clu12__Cancer cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name, col.name = "cluster_name")
cluster_name_slim <- as.factor(unlist(lapply(strsplit(as.character(cluster_name), "__"),function(input){input[2]})))
data1 <- AddMetaData( object = data1, metadata = cluster_name_slim, col.name = "cluster_name_slim")
Idents(data1) <- "cluster_name_slim"
pdf(file = "dimplot_celltype_slim.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 1)
dev.off()
pdf(file = "Spatialplot.pdf",width = 12,height = 12)
SpatialPlot(data1, features = c("SIGLEC1","CD22","SIGLEC15","CD33","SIGLEC5","SIGLEC6","SIGLEC7","SIGLEC8","SIGLEC9","SIGLEC10","SIGLEC11","SIGLEC16"),ncol = 4)
dev.off()
saveRDS(data1,"data.rds")
Idents(total)
Idents(data1)
View(data1)
Idents(data1) <- "SCT_snn_res.1"
cluster_name <- plyr::mapvalues(x = data1@active.ident, from = 0:13, to = c("clu0__T cell","clu1__Fibroblast","clu2__Plasma cell","clu3__Macrophage","clu4__Cancer cell","clu5__Cancer cell",
"clu6__Cancer cell","clu7__Glandular cell","clu8__Fibroblast","clu9__Macrophage","clu10__Endothelial","Clu11__Fibroblast","Clu12__Cancer cell","Clu13__Glandular cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name, col.name = "cluster_name")
cluster_name_slim <- as.factor(unlist(lapply(strsplit(as.character(cluster_name), "__"),function(input){input[2]})))
data1 <- AddMetaData( object = data1, metadata = cluster_name_slim, col.name = "cluster_name_slim")
Idents(data1) <- "cluster_name_slim"
pdf(file = "dimplot_celltype_slim.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 1)
dev.off()
pdf(file = "Spatialplot.pdf",width = 12,height = 12)
SpatialPlot(data1, features = c("SIGLEC1","CD22","SIGLEC15","CD33","SIGLEC5","SIGLEC6","SIGLEC7","SIGLEC8","SIGLEC9","SIGLEC10","SIGLEC11","SIGLEC16"),ncol = 4)
dev.off()
saveRDS(data1,"data.rds")
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 2)
dev.off()
?SpatialPlot
pdf(file = "Spatialplot.pdf",width = 12,height = 12)
SpatialPlot(data1, features = c("SIGLEC1","CD22","SIGLEC15","CD33","SIGLEC5","SIGLEC6","SIGLEC7","SIGLEC8","SIGLEC9","SIGLEC10","SIGLEC11","SIGLEC16"),ncol = 3,pt.size.factor=2)
dev.off()
data1 <- readRDS("data.rds")
library(Seurat)
library(ggplot2)
library(cowplot)
library(dplyr)
cluster_name_slim <- factor(unlist(lapply(strsplit(as.character(cluster_name), "__"),function(input){input[2]})),
levels = c("Macrophage","Cancer cell","Fibroblast","Endothelial cell","Glandular cell","Plasma cell","T cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name_slim, col.name = "cluster_name_slim")
Idents(data1) <- "cluster_name_slim"
pdf(file = "dimplot_celltype_slim.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 2)
dev.off()
pdf(file = "dimplot_celltype_slim.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
markers <- c("SIGLEC1","CD22","SIGLEC15","CD33","SIGLEC5","SIGLEC6","SIGLEC7","SIGLEC8","SIGLEC9","SIGLEC10","SIGLEC11","SIGLEC16")
pdf(file = "Spatialplot.pdf",width = 20,height = 12)
SpatialPlot(data1, features = markers,ncol = 5,pt.size.factor=2)
dev.off()
pdf(file = "VlnPlot.pdf",width = 12,height = 5)
VlnPlot(data1,features = markers,pt.size = 0.1,group.by="cluster_name_slim",stack=T,fill.by="ident")+theme(axis.text=element_text(size=9), axis.title=element_text(size=9,face="bold"))+ RotatedAxis()
dev.off()
cluster_name <- plyr::mapvalues(x = data1@active.ident, from = 0:13, to = c("clu0__T cell","clu1__Fibroblast","clu2__Plasma cell","clu3__Macrophage","clu4__Cancer cell","clu5__Cancer cell",
"clu6__Cancer cell","clu7__Glandular cell","clu8__Fibroblast","clu9__Macrophage","clu10__Endothelial","Clu11__Fibroblast","Clu12__Cancer cell","Clu13__Glandular cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name, col.name = "cluster_name")
cluster_name_slim <- factor(unlist(lapply(strsplit(as.character(cluster_name), "__"),function(input){input[2]})),
levels = c("Macrophage","Cancer cell","Fibroblast","Endothelial cell","Glandular cell","Plasma cell","T cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name_slim, col.name = "cluster_name_slim")
Idents(data1) <- "cluster_name_slim"
pdf(file = "dimplot_celltype_slim.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 2)
dev.off()
View(data1)
View(data1)
Idents(data1) <- "SCT_snn_res.1"
cluster_name <- plyr::mapvalues(x = data1@active.ident, from = 0:13, to = c("clu0__T cell","clu1__Fibroblast","clu2__Plasma cell","clu3__Macrophage","clu4__Cancer cell","clu5__Cancer cell",
"clu6__Cancer cell","clu7__Glandular cell","clu8__Fibroblast","clu9__Macrophage","clu10__Endothelial","Clu11__Fibroblast","Clu12__Cancer cell","Clu13__Glandular cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name, col.name = "cluster_name")
cluster_name_slim <- factor(unlist(lapply(strsplit(as.character(cluster_name), "__"),function(input){input[2]})),
levels = c("Macrophage","Cancer cell","Fibroblast","Endothelial cell","Glandular cell","Plasma cell","T cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name_slim, col.name = "cluster_name_slim")
Idents(data1) <- "cluster_name_slim"
pdf(file = "dimplot_celltype_slim.pdf",width = 6,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 2)
dev.off()
pdf(file = "VlnPlot.pdf",width = 12,height = 5)
VlnPlot(data1,features = markers,pt.size = 0.1,group.by="cluster_name_slim",stack=T,fill.by="ident")+theme(axis.text=element_text(size=9), axis.title=element_text(size=9,face="bold"))+ RotatedAxis()
dev.off()
pdf(file = "dimplot_celltype_slim.pdf",width = 8,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "dimplot_celltype_slim.pdf",width =7,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
Idents(data1) <- "SCT_snn_res.1"
cluster_name <- plyr::mapvalues(x = data1@active.ident, from = 0:13, to = c("clu0__T cell","clu1__Fibroblast","clu2__Plasma cell","clu3__Macrophage","clu4__Cancer cell","clu5__Cancer cell",
"clu6__Cancer cell","clu7__Glandular cell","clu8__Fibroblast","clu9__Macrophage","clu10__Endothelial cell","Clu11__Fibroblast","Clu12__Cancer cell","Clu13__Glandular cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name, col.name = "cluster_name")
cluster_name_slim <- factor(unlist(lapply(strsplit(as.character(cluster_name), "__"),function(input){input[2]})),
levels = c("Macrophage","Cancer cell","Fibroblast","Endothelial cell","Glandular cell","Plasma cell","T cell"))
data1 <- AddMetaData( object = data1, metadata = cluster_name_slim, col.name = "cluster_name_slim")
Idents(data1) <- "cluster_name_slim"
pdf(file = "dimplot_celltype_slim.pdf",width =7,height = 6)
DimPlot(data1, reduction = "umap",split.by = NULL,label=T, pt.size=0.1, label.size=4)
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 2)
dev.off()
pdf(file = "VlnPlot.pdf",width = 12,height = 5)
VlnPlot(data1,features = markers,pt.size = 0.1,group.by="cluster_name_slim",stack=T,fill.by="ident")+theme(axis.text=element_text(size=9), axis.title=element_text(size=9,face="bold"))+ RotatedAxis()
dev.off()
pdf(file = "Spatial_dimplot.pdf",width = 6,height = 6)
SpatialDimPlot(data1,label=F,label.size=3,pt.size.factor = 1.5)
dev.off()
saveRDS(data1,"data.rds")
library(Seurat)
library(ggplot2)
library(cowplot)
library(dplyr)
data1 <- readRDS("data.rds")
pdf(file = "DotPlot.pdf",width = 8,height = 4)
DotPlot(data1, features = markers, cols = c("navy", "#F6E921"), dot.scale = 6)  + theme(axis.text=element_text(size=12), axis.title=element_text(size=12,face="bold")) + RotatedAxis()
dev.off()
markers <- c("SIGLEC1","CD22","SIGLEC15","CD33","SIGLEC5","SIGLEC6","SIGLEC7","SIGLEC8","SIGLEC9","SIGLEC10","SIGLEC11","SIGLEC16")
pdf(file = "DotPlot.pdf",width = 8,height = 4)
DotPlot(data1, features = markers, cols = c("navy", "#F6E921"), dot.scale = 6)  + theme(axis.text=element_text(size=12), axis.title=element_text(size=12,face="bold")) + RotatedAxis()
dev.off()
library(Seurat)
library(ggplot2)
library(cowplot)
library(dplyr)
data1 <- readRDS("data.rds")
markers <- c("CD24","CD47","CD274","B2M","SIGLEC10","SIRPA")
pdf(file = "DotPlot_2.pdf",width = 8,height = 4)
DotPlot(data1, features = markers, cols = c("navy", "#F6E921"), dot.scale = 6)  + theme(axis.text=element_text(size=12), axis.title=element_text(size=12,face="bold")) + RotatedAxis()
dev.off()
DefaultAssay(data1)
